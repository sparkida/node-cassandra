<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>node-cassandra  <a href="https://travis-ci.org/vertebrae-org/node-cassandra"><img src="https://travis-ci.org/vertebrae-org/node-cassandra.svg?branch=master" alt="Build Status"></a> <a href="https://coveralls.io/github/vertebrae-org/node-cassandra?branch=master"><img src="https://coveralls.io/repos/github/vertebrae-org/node-cassandra/badge.svg?branch=master" alt="Coverage Status"></a></h1><!-- badge image references -->
<p>Cassandra ORM for NodeJS, based on the <strong><em>cassandra-driver</em></strong> module.</p>
<p><strong>Read the</strong> <a href="http://vertebrae-org.github.io/node-cassandra">full API Documentation</a>.</p>
<p><strong>Examples:</strong></p>
<ul>
<li><a href="#user-content-getting-started">Getting Started</a><ul>
<li><a href="#user-content-connecting-to-the-database">Connecting</a></li>
<li><a href="#user-content-creating-your-first-schema-model-and-materialized-view">Your first Schema, Model, and Materialized View</a></li>
</ul>
</li>
<li><a href="#user-content-table-compaction">Table Compaction</a></li>
<li><a href="#user-content-static-methods">Static Methods</a></li>
<li><a href="#user-content-list-types">Working with List Types</a><ul>
<li><a href="#user-content-inserting-lists">Inserting Lists</a></li>
<li><a href="#user-content-updating-lists">Updating Lists</a></li>
<li><a href="#user-content-updating-lists-by-index">Updating Lists By Index</a></li>
<li><a href="#user-content-deleting-lists-by-column-or-index">Deleting Lists</a></li>
</ul>
</li>
<li><a href="#user-content-set-types">Working with Set Types</a><ul>
<li><a href="#user-content-inserting-sets">Inserting Sets</a></li>
<li><a href="#user-content-updating-sets">Updating Sets</a></li>
<li><a href="#user-content-deleting-sets">Deleting Sets</a></li>
</ul>
</li>
<li><a href="#user-content-map-types">Working with Map Types</a><ul>
<li><a href="#user-content-inserting-maps">Inserting Maps</a></li>
<li><a href="#user-content-updating-maps">Updating Maps</a></li>
<li><a href="#user-content-deleting-maps-by-keys">Deleting Maps by Keys</a></li>
<li><a href="#user-content-deleting-maps">Deleting Maps</a></li>
</ul>
</li>
</ul>
<h4>Cassandra Known Versions Supported:</h4>

<ul>
<li>3.x</li>
</ul>
<h4>Known Supported NodeJS Versions:</h4>

<ul>
<li>&lt;= 7.6</li>
<li>6.x</li>
<li>5.x</li>
</ul>
<h3>Getting Started</h3>

<h4>Connecting to the database</h4>

<pre class="prettyprint source lang-javascript"><code>var Cassandra = require('node-cassandra');
var config = {
    contactPoints: ['127.0.0.1:9042'],
    protocolOptions: {port: 9042},
    keyspace: {
        testkeyspace: {
            durableWrites: true,
            withReplication: {
                class: 'SimpleStrategy',
                replication_factor: 1
            }
        }
    }
};

var cassandra = Cassandra.connect(config);
cassandra.on('error', (err) => console.log(err));
cassandra.on('connect', (err) => console.log('connected'));</code></pre><h4>Creating your first Schema, Model and Materialized View</h4>

<pre class="prettyprint source lang-javascript"><code>//create a new schema
var schema = new Cassandra.Schema({
    id: {
        type: 'uuid',
        default: Cassandra.uuid
    },
    username: {
        type: 'text',
        required: true
    },
    ageName: {
        type: 'text',
        default: (instance) => { 
            //default value functions are passed the object instance
            return instance.age + instance.name;
        }
    },
    name: 'text',
    age: 'int'
}, {
    primaryKeys: ['username'],
    views: {
        byName: {
            primaryKeys: ['name'],
            orderBy: {
                name: 'asc'
            }
        },
    }
});

//create model
var TestModel = cassandra.model('testModel', schema, (err) => {
    test.save((err) => {
        if (err) {
            throw err;
        }
        console.log('test saved!');
        test.age = 29;
        test.save((err) => {...});
        //test.age updated
    });
});

var test = new TestModel({
    name: 'bar',
    username: 'foo',
    age: 30
});</code></pre><h3>Working with Collections and Indexes</h3>

<p><h4>List Types</h4></p>
<pre class="prettyprint source lang-javascript"><code>//create a new schema
var schema = new Cassandra.Schema({
    name: 'text',
    usernames: {
        type: {
            list: 'text'
        }
    }
}, {
    indexes: ['usernames'], //create an index on the usernames column
    primaryKeys: ['name']
});</code></pre><p><h5>Inserting lists</h5></p>
<pre class="prettyprint source lang-javascript"><code>//create model
var TestModel = cassandra.model('testModel', schema, (err) => {
    var test = new TestModel({
        name: 'bar',
        usernames: ['foo', 'bar']
    });
    test.save(() => {
        TestModel.findOne({
            usernames: {
                $contains: 'foo'
            }
        }, (err, row) => {
            console.log(row.usernames); //['foo', 'bar']
        });
    });
});</code></pre><p><h5>Updating lists</h5></p>
<pre class="prettyprint source lang-javascript"><code>//following above
var query = {
    name: 'bar',
    usernames: {
        $contains: 'foo'
    }
};
var updateObject = {
    usernames: {
        $filter: ['foo'], //remove items matching &quot;foo&quot;
        $append: ['baz'], //append item &quot;baz&quot;
        $prepend: ['fii'] //prepend item &quot;fii&quot;
    }
};
TestModel.update(query, updateObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne({usernames: {$contains: 'baz'}}, (err, row) => {
        console.log(row.usernames); //['fii', 'bar', 'baz']
    });
});</code></pre><p><h5>Updating lists by index</h5></p>
<pre class="prettyprint source lang-javascript"><code>//following above
var query = {
    name: 'bar',
    usernames: {
        $contains: 'bar'
    }
};
var updateObject = {
    usernames: {
        $set: {
            0: 'foo'
        }
    }
};
TestModel.update(query, updateObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne(query, (err, row) => {
        console.log(row.usernames); //['foo', 'bar', 'baz']
    });
});</code></pre><p><h5>Deleting lists by column or index</h5></p>
<pre class="prettyprint source lang-javascript"><code>//following above
var query = {
    name: 'bar',
    usernames: {
        $contains: 'fii'
    }
};
var deleteObject = {
    usernames: [0,2] //delete first and last index
};
TestModel.delete(query, deleteObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne({usernames: {$contains: 'bar'}}, (err, row) => {

        console.log(row.usernames); //['bar']

        TestModel.delete({
            usernames: {
                $contains: 'bar'
            }
        }, {
            usernames: 1 //delete usernames column
        }, (err) => {...});

    });
});</code></pre><p><h4>Set Types</h4></p>
<pre class="prettyprint source lang-javascript"><code>//create a new schema
var schema = new Cassandra.Schema({
    name: 'text',
    usernames: {
        type: {
            set: 'text'
        }
    }
}, {
    indexes: ['usernames'], //create an index on the usernames column
    primaryKeys: ['name']
});</code></pre><p><h5>Inserting sets</h5></p>
<pre class="prettyprint source lang-javascript"><code>//create model
var TestModel = cassandra.model('testModel', schema, (err) => {
    var test = new TestModel({
        name: 'bar',
        usernames: ['foo', 'bar']
    });
    test.save(() => {
        TestModel.findOne({
            usernames: {
                $contains: 'foo'
            }
        }, (err, row) => {
            console.log(row.usernames); //['bar', 'foo']
        });
    });
});</code></pre><p><h5>Updating sets</h5></p>
<pre class="prettyprint source lang-javascript"><code>//following above
var query = {
    name: 'bar',
    usernames: {
        $contains: 'bar'
    }
};
var updateObject = {
    usernames: {
        $add: ['aba', 'boa'],
        $filter: ['foo']
    }
};
TestModel.update(query, updateObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne(query, (err, row) => {
        console.log(row.usernames); //['aba', 'bar', 'boa']
    });
});</code></pre><p><h5>Update sets to null</h5></p>
<pre class="prettyprint source lang-javascript"><code>//following above
var query = {
    name: 'bar',
    usernames: {
        $contains: 'bar'
    }
};
var updateObject = {
    usernames: [] //or null
};
TestModel.update(query, updateObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne(query, (err, row) => {
        console.log(row.usernames); //null
    });
});</code></pre><p><h5>Deleting sets</h5></p>
<pre class="prettyprint source lang-javascript"><code>//not much you can do with deleting sets
var query = {
    name: 'bar',
    usernames: {
        $contains: 'fii'
    }
};
var deleteObject = {
    usernames: 1 //delete usernames column
};
TestModel.delete(query, deleteObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne({name: 'bar'}, (err, row) => {
        console.log(row.usernames); //null
    });
});</code></pre><p><h4>Map Types</h4></p>
<pre class="prettyprint source lang-javascript"><code>//create a new schema
var schema = new Cassandra.Schema({
    name: 'text',
    usernames: {
        type: {
            map: ['text', 'int']
        }
    }
}, {
    indexes: ['usernames'], //create an index on the usernames column keys
    primaryKeys: ['name']
});</code></pre><p><h5>Inserting maps</h5></p>
<pre class="prettyprint source lang-javascript"><code>//create model
var TestModel = cassandra.model('testModel', schema, (err) => {
    var test = new TestModel({
        name: 'bar',
        usernames: {
            $set: {
                foo: 2,
                bar: 4
            }
        }
    });
    test.save(() => {
        TestModel.findOne({
            usernames: {
                $containsKey: 'foo' //use containsKey for maps
            }
        }, (err, row) => {
            console.log(row.usernames.foo); // 2
        });
    });
});</code></pre><p><h5>Updating maps</h5></p>
<pre class="prettyprint source lang-javascript"><code>//following above
var query = {
    name: 'bar',
    usernames: {
        $containsKey: 'bar'
    }
};
var updateObject = {
    usernames: {
        foo: 5, //update &quot;foo&quot; to 5
        fii: 7 /set &quot;fii&quot; to 7
    }
};
TestModel.update(query, updateObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne(query, (err, row) => {
        console.log(row.usernames.foo); // 5
    });
});</code></pre><p><h5>Deleting maps by Keys</h5></p>
<pre class="prettyprint source lang-javascript"><code>//not much you can do with deleting maps
var query = {
    name: 'bar',
    usernames: {
        $containsKey: 'bar'
    }
};
var deleteObject = {
    usernames: ['foo']
};
TestModel.delete(query, deleteObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne(query, (err, row) => {
        console.log(row.usernames.foo); // undefined
    });
});</code></pre><p><h5>Deleting maps</h5></p>
<pre class="prettyprint source lang-javascript"><code>//not much you can do with deleting maps
var query = {
    name: 'bar',
    usernames: {
        $containsKey: 'bar'
    }
};
var deleteObject = {
    usernames: 1
};
TestModel.delete(query, deleteObject, (err) => {
    if (err) {
        return console.log(err):
    }
    TestModel.findOne(query, (err, row) => {
        console.log(row.usernames); // null
    });
});</code></pre><h2>Table Compaction</h2><pre class="prettyprint source lang-javascript"><code>//create a new schema
var schema = new Cassandra.Schema({
    id: 'uuid',
    name: 'text'
}, {
    primaryKeys: ['username'],
    compaction: {
        class: 'DateTieredCompactionStrategy', 
        timestamp_resolution: 'MICROSECONDS',
        base_time_seconds: 3600, 
        max_sstable_age_days: 365
    }
});</code></pre><h2>Static Methods</h2><pre class="prettyprint source lang-javascript"><code>//create a new schema
var schema = new Cassandra.Schema({
    id: {
        type: 'uuid',
        default: Cassandra.uuid
    },
    username: {
        type: 'text',
        required: true
    },
    name: 'text'
}, {
    primaryKeys: ['username'],
    views: {
        byName: {
            primaryKeys: ['name']
        },
    }
});

//attach static method - fat arrow functions won't work here as we need the context to change
schema.statics.findByName = function (name, callback) {
    this.views.byName.findOne({name: name}, callback);  
};

//create model
var TestModel = cassandra.model('testModel', schema, (err) => {
    TestModel.findByName('foo', (err, row) => {
        console.log(row.name); // &quot;foo&quot;
    });
});</code></pre><h2>Stress Utility</h2><p>node-cassandra includes an interactive command line utility.</p>
<ul>
<li>read - make n asynchronous read requests, with n iterations</li>
<li>write - make multiple write requests, creates fake user data</li>
<li>load - make n read requests per second (randomized timing), with n iterations</li>
<li>count - count how many rows you have created with the write command</li>
<li>clean - drop the keyspace and exit</li>
<li>help - display the help text below</li>
</ul>
<p>running <code>node ./stress --help</code></p>
<pre class="prettyprint source"><code>NODE-CASSANDRA STRESS UTILITY

  SYNOPSIS
      node ./stress [OPTIONS]

  OPTIONS
      --host           cassandra host address (default=127.0.0.1)
      --port           cassandra listen port (default=9042)
      --keyspace       cassandra table keyspace (default=loadtest)
      --cluster        run tests in cluster mode
      --nodes          number of nodes to spawn in cluster mode (default=numCPUs)
      --help           show this help</code></pre><ul>
<li>Setting &quot;--cluster&quot; will start the cli in cluster mode.  By default, one node will fork for each CPU core.  You can manually set the number of forks with &quot;--nodes&quot; option.</li>
<li>In cluster mode read, write, and load tests will be performed in parallel on each node.  If you have 4 nodes running, then write 1000 rows, you will be writing 4000 rows to the database.</li>
</ul></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseModel.html">BaseModel</a></li><li><a href="Cassandra.html">Cassandra</a></li><li><a href="Cassandra.Model.html">Model</a></li><li><a href="Cassandra.Model.ColumnFamily.html">ColumnFamily</a></li><li><a href="Cassandra.Model.MaterializedView.html">MaterializedView</a></li><li><a href="Cassandra.Model.ModelInstance.html">ModelInstance</a></li><li><a href="Cassandra.Schema.html">Schema</a></li></ul><h3>Mixins</h3><ul><li><a href="AbstractModel.html">AbstractModel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ConnectionOptions">ConnectionOptions</a></li><li><a href="global.html#getArgCount">getArgCount</a></li><li><a href="global.html#getFilteredArgs">getFilteredArgs</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Mar 02 2017 08:27:22 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>